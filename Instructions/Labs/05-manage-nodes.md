---
lab:
  title: ノードを管理する
  module: Manage topics in Microsoft Copilot Studio
---

# ノードを管理する

## シナリオ

この演習では、次のことを行います。

- 会話フローを作成する
- 変数の管理

この演習の所要時間は約 **30** 分です。

## 学習する内容

- トピックにノードを追加して会話フローを作成する方法

## ラボ手順の概要

- 変数スコープを構成する
- ノードの作成と編集
- エージェントをデプロイしてテストする
  
## 前提条件

- **ラボ: トピックの管理**を完了している必要があります

## 詳細な手順

## 演習 1 - 変数スコープ

変数には他のトピックからアクセスできます。

### タスク 1.1 - 変数のスコープを構成する

1. Copilot Studio ポータル `https://copilotstudio.microsoft.com` に移動し、適切な環境にあることを確認します。

1. 左側のナビゲーション ウィンドウから **[エージェント]** を選択します。

1. 前のラボで作成したエージェントを選択します。

1. **[トピック]** タブを選択します。

1. **[Customer Details]** トピックを選択します。

1. 変数ウィンドウを開くには、トピックのメニュー バーで、**[Variables]** を選択します。

1. 3 つのトピック変数の右側のチェック ボックスをオンにします。

    ![変数ペインのスクリーンショット。](../media/variables-pane.png)

1. **[保存]** を選択します。

## 演習 2 - トピックを手動で作成する

トピック内の会話フローは、ノードを追加して手動で作成できます。

### タスク 2.1 - メッセージ ノードを追加する

1. **[トピック]** タブを選択します。

1. **[不動産の内見を予約する]** トピックを選択します。

1. トリガー ノードの下にある **[+]** アイコンを選択し、**[メッセージを送信する]** を選択します。

    ![ノードの追加のスクリーンショット。](../media/add-node.png)

1. **「メッセージを送信する」** フィールドに、次のテキストを入力します。

    `こんにちは。不動産物件の内見予約をお手伝いします。`

1. **[保存]** を選択します。

### タスク 2.2 - トピック管理ノードを追加する

1. **[メッセージ]** ノードの下の **+** アイコンを選択し、**[トピック管理]** > **[別のトピックに移動]** > **[お客様の詳細]** を選択します。

    ![トピック管理ノードの追加のスクリーンショット。](../media/topic-management-node.png)

1. **[保存]** を選択します。

### タスク 2.3 - 条件を追加する

1. **[リダイレクト]** ノードの下にある **[+]** アイコンを選択し、**[条件を追加]** を選択します。

1. **[条件]** ノードで、**[DetailsCorrect]** 変数を選択します。

1. **[次と等しい]** を選択します。

1. **[はい]** を選択します。

    ![条件ノードの追加のスクリーンショット。](../media/condition-node.png)

1. **[保存]** を選択します。

### タスク 2.4 - 質問ノードを追加する

1. 左側の **[条件]** ノードの下にある **[+]** アイコンを選択し、**[質問をする]** を選択します。

1. **「メッセージを送信する」** フィールドに、次のテキストを入力します。

    `どの物件をご覧になりますか?`

1. **[特定]** には、**[ユーザーの応答全体]** を選択します。

1. **[ユーザーの応答を名前をつけて保存]** で変数を選択し **[変数名]** に「**`PropertyName`**」と入力します。

    ![質問ノードの追加のスクリーンショット。](../media/question-node-2.png)

1. **[保存]** を選択します。

1. 新しい **質問** ノードの **[+]** アイコンを選択し、**[質問をする]** を選択します。

1. **「メッセージを送信する」** フィールドに、次のテキストを入力します。

    `物件を見学したい日時はいつですか?`

1. **[特定]** で **[日付と時刻]** を選択します。

1. **[ユーザーの応答を名前をつけて保存]** で変数を選択し **[変数名]** に「**`DateTime`**」と入力します

1. **[保存]** を選択します。

### タスク 2.5 - エージェントをテストする

1. 開かない場合は、画面の右上にある **[テスト]** ボタンを選択してテスト パネルを開きます。

1. 画面の右上にあるテスト パネルの上部にある **3 つのドット**を選択します。

1. 有効になっていない場合は、 **[トピック間の追跡]** を有効にします。

    ![テスト パネル オプションのスクリーンショット。](../media/test-pane-options.png)

1. テスト パネルの上部にある **[新しい会話を開始する]** (更新) アイコンを選択します。

1. **会話の開始**メッセージが表示されたら、エージェントによって会話が開始されます。 応答に、先に作成したトピックのトリガー フレーズを入力します。

    `不動産の内見を予約したい`

1. エージェントは、次の図に示すように、「あなたの名前は何ですか?」という質問で応答します。

    ![会話の開始メッセージおよび応答のスクリーンショット。](../media/conversation-start-message.png)

1. 名前とメール アドレスを入力します。

1. 情報を入力すると、入力した情報がアダプティブ カードに表示され、詳細が正しいかどうかを確認します。 **[はい]** を選択します。

1. 「どの物件をご覧になりますか?」というプロンプトに `555 Oak Lane, Denver, CO 80203` を入力します。

1. 「物件を見学したい日時はいつですか?」というプロンプトに `明日の 10:00 AM` を入力します。

    ![情報が入力されたアダプティブ カードのスクリーンショット。](../media/adaptive-card-information.png)

## 演習 3 - エージェントをデプロイする

### タスク 3.1 - 認証の構成

1. **不動産予約サービス** の右上にある **[設定]** を選択します。

1. **[セキュリティ]** タブをクリックします。

1. **認証** タイルを選択します。

    ![認証設定のスクリーンショット。](../media/configure-authentication.png)

1. **認証なし**を選択します。

1. **[保存]** を選択します。

1. 確認ウィンドウで **[保存]** を選択します。

1. 右上隅にある **X** を選択して、**[設定]** を閉じます。

### タスク 3.2 - エージェントを発行する

1. 右上にある **[Publish]** を選択し、もう一度 **[Publish]** を選択します。

### タスク 3.3 - デモ Web サイト

1. 画面の右上にある **[設定]** ボタンの横にある **3 つのドット**を選択し、**[デモ Web サイトに移動]** を選択します。

1. **[メッセージを入力]** テキスト ボックスに、「**`物件を予約したい`**」と入力します。

1. プロンプトに答えて、エージェントをテストします。
